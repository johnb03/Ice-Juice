---
// A button that appears on scroll and smoothly scrolls the user to the top.
---

<button
    id="scroll-to-top-btn"
    title="Go to top"
    class="fixed bottom-20 right-3 z-50 p-3 rounded-full bg-slate-50/50 text-palette-1-almost-black-green shadow-lg hover:bg-palette-2-olive-green focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-palette-3-electric-lime transition-opacity duration-300 transform hover:scale-110"
>
    <i class="bx bx-up-arrow-alt text-2xl"></i>
</button>

<style>
    #scroll-to-top-btn {
        opacity: 0;
        pointer-events: none;
    }
    #scroll-to-top-btn.is-visible {
        opacity: 1;
        pointer-events: auto;
    }
</style>

<script>
    document.addEventListener("astro:page-load", () => {
        const scrollBtn = document.getElementById("scroll-to-top-btn");
        if (!scrollBtn) return;

        // Function to show/hide the button by toggling a class
        const toggleVisibility = () => {
            if (window.scrollY > 300) {
                scrollBtn.classList.add("is-visible");
            } else {
                scrollBtn.classList.remove("is-visible");
            }
        };

        const scrollToTop = () => {
            window.scrollTo({
                top: 0,
                behavior: "smooth",
            });
        };

        window.addEventListener("scroll", toggleVisibility);
        scrollBtn.addEventListener("click", scrollToTop);

        // Initial check in case the page loads already scrolled
        toggleVisibility();

        // Cleanup to prevent memory leaks on page navigation
        document.addEventListener(
            "astro:before-swap",
            () => {
                window.removeEventListener("scroll", toggleVisibility);
                scrollBtn.removeEventListener("click", scrollToTop);
            },
            { once: true },
        );
    });
</script>
